name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read
  pull-requests: write

jobs:
  lint:
    name: Lint
    uses: ./.github/workflows/lint.yml

  build:
    name: Build
    uses: ./.github/workflows/go-build.yml

  test:
    name: Test
    uses: ./.github/workflows/go-test.yml

  e2e:
    name: E2E Test
    uses: ./.github/workflows/e2e-test.yml

  security:
    name: Security Scan
    uses: ./.github/workflows/trivy-scan.yml
    with:
      scan-type: 'fs'
      scan-ref: '.'
      severity: 'HIGH,CRITICAL'
      ignore-unfixed: true
      exit-code: '1'
